

IN-PROGRESS:






ISSUES:

livestream crashes, need super low-res startup, set hi-resolution maps
  running 9 planets and 3 moons and a sun and rocket.. is slow.. especially
  with orbit lines... so efficiency needs to be improved.
why slow?
- loading all planets & moons with textures at the same time
- polygons, gltf models
- high res textures
- two scenes
- orbit lines
    recalculating some elements (i, lan, w) and redrawing on every frame
    ellipse with 500 points
- rockets are part of n-body physics
- gps velocity unnecessary?
- general efficiency can probably be drastically improved
- orbMech settings for transcendental equation
initialization-only
- loading the whole threejs instead of just modules
    but i prefer console use (n/a with modules)
- processing space data (instead of it being pre-processed)

gui hud numbers wrapping, and going outside of tinted background

spacecraft rotation from warp is wrong.. requires complicated formula.

401 surface and graphics are WAY off
  more than just the dips in polygons
  is it really oblate? landing on 401 makes me think no.
not appearing on surface
  rotate earth mesh so rocket is at peak point?
  collision with surface graphics, with accurate gps
  surface graphics and gps ARE accurate??, if using
  1024 segments... so it just depends on segment
  heights.?? not true for 401!!

known & intended hyperbolic "safe crash" needs proper exit
  when iterations > 9999 to solve, NaN occurs
  need proper exit / catch

firefox mobile 96.0.0-beta.5 scrolling to hide address bar
  causes screen to resize wrong

crash at center of planet

rocket goes down when low thrust on surface

ecliptic lan parameter is off by almost precisely 90 deg, not sure why
  (ecliptic notes below)


HIGH PRIORITY FEATURE REQUESTS:

rotate with surface while landed
  rotate with parent
  attach independent child object at location of landing.
  set with rotation of rocket. copy that rotation.
  if the rocket is rotated manually then rotate the clone.



MEDIUM PRIORITY FEATURE REQUESTS:

camera should start UP, wherever you start

make menu look nice, nicer user interface (menus, info, more options)
  show/hide axes (planets, etc)
  show/hide individual orbit lines
  gui buttons sizes mobile (normal) vs desktop etc

make menu larger for big screens, ok for smaller screens?



LOW PRIORITY FEATURE REQUESTS:


select launch location

constellation map

air density on other planets
  re-entry heat
visual clouds
  planets 2, 3, maybe 4, maybe a few moons

terrain: bump/relief map w/collision detection
  aerodynamics and negative altitude loss of momentum will need to be revised
  
GRAPHICS
  sky color during daytime or in thick atmosphere, from camera location
  shadows, especially for planet 6 rings
    use DirectionalLight or SpotLight near planet

"maxq" appears on screen when passed

first person camera

fuel, weight, thrust, deltaV ratios

major moons, asteroids, comets for sure, all ~200 moons hopefully

assorted rocket models, using stats
multiple satellites
track any asteroid or object

adjustable scale

restore camera zoom level on view change?






USER INTERFACE

  navball prograde, radial, normal markers for eci & ecef
    target anti-target marker
    maneuver marker


  orbitcontrols option for large bodies, with min zoom, *angle*
    solve zoom difficulty issue
    solve pole angle issue

  real-time sync (already coded in an old version)


MULTI
  multiple satellites, "inFlight" variable
  save/load state
    landing boosters
    docking & transfer of resources (fuel, etc)
  multiplayer
    send/receive orbit info
    login



SPACECRAFT
  spacecraft detail
    solar panels & power
    radiators & temperature
    life support
    reaction wheel
    rcs
    ignition count
  communications satellites
  different rockets
  staging
  buildable rockets
    shape, size, engine/fuel types
  eva & spacecraft repair and upgrades
  rovers (wheels & terrain physics)
  ion thrust & long-term acceleration


MULTIPLAYER WEB SERVER

client side
  orbital info is received
    view orbits (including your own)
  launch spacecraft
    orbital info is sent to server

server side
  run simulation 24/7 with thousands of orbits
  send orbit data upon request
  receive orbit data and update database



TRACKING IDEAS

spacecraft identifying info:
  country (based on ip address) & number
  launch date & time
  rocket type & number

TRACKING EXAMPLE:

1-USA-1-FALCON9-1
2019-01-19T13:16:30.000Z

2-USA-2-STARSHIP-SN8-1

SPACECRAFT UNIQUE ID: 1
ROCKET MODEL: FALCON 9 BLOCK 5
ROCKET SERIAL NUMBER: 1
PAYLOAD MODEL: (SATELLITE TYPE i.e. hubble)
PAYLOAD SERIAL NUMBER: 1

LAUNCH DATE: 2019-01-19T13:16:30.000Z
LAUNCHED FROM: KOUROU
LAUNCHPAD LAUNCH NUMBER: 1
LAUNCHPAD COUNTRY: FRENCH GUIANA (FRANCE)

MISSION CONTROL: MIAMI
MISSION CONTROL LAUNCH NUMBER: 1

COUNTRY OF ORIGIN: USA
COUNTRY OF ORIGIN LAUNCH NUMBER: 1


FLIGHT OPERATIONS LANGUAGE: ENGLISH
ONBOARD COMPUTER: ANDROID
LAUNCH NAVIGATION: FIREFOX
IP ADDRESS
BROWSER INFO









PROGRAM FLOW (simplified)


populate body array, conversions, mostMassiveBody
  cartes (local icrf)
threejs setup & objects, resize(), fullscreen()

systemPosition() LOOP BODY
viewControl
time



--- main loop ---

rocketControl()

nBodyVelocity() LOOP BODY
  spin planets
    define focus
    accelerate

keplerPosition() LOOP BODY
  cartes.xyz = -focusDistanceXYZ
  cartes.vxyz = vxyx - focus.vxyz           ALL/ROCKETS-ONLY
  cartes.vxyz -= focus acceleration
    icrfToEci()                             icrfToEci
      toKepler()                            toKepler
        if (!onSurface)
          meanAnom++
          j2++                              j2
      toCartes()                            toCartes
      if (Artificial)
        if (!onSurface)
          eciToEcef()                           eciToEcef ecefToGps gpsToEcef getDir
          ecefToGps()                           ecefToGps
          if (alt == 0)
            v 0,0,0 and onSurface = true
        if (onSurface)
          ecefToEci()                           ecefToEci ecefToGps gpsToEcef getDir
          drag equations...                     drag?
    eciToIcrf()                             eciToIcrf

systemPosition() LOOP BODY
time++
displayText()

--- main loop ---

preAnimate()
  drawEllipse
    toKepler()                              toKepler
      draw, position, and rotate ellipse    new ellipse
  navBall getDirections()
  camera
  render



VARIABLE          POSITION
body[i].x         universal icrf (solar system barycenter)
body[i].cartes.x  local icrf (when finished)
body[i].ecef.x    local ecef

body[i].eci.x     local eci (if not commented out)



BROWSER RENDERING

firefox mobile setting that changes resolution:
layout.css.devPixelsPerPx
preferred resolution: 1.6

JavaScript
window.devicePixelRatio



ALTITUDE

- gps tells you MSL: Mean Sea Level at specific location. it's accurate, even with oblate spheroids, but it does NOT tell you the height of actual physical surface features, like mountains and valleys (which are not implemented)...
- Ap shows MSL of equatorial.




// shadow setup
if (focus === 0) {
// setup a DirectionalLight
// positioned outside if the furthest child
// in the direction of the sun, facing back

















orbital speed at equator when surface speed is zero
va = 0.0000729211585454431
vt = va * distance
vt = 465.10113940155685


rings outer radius
140,180 + 235 = 140415

width 30 - 500?
(500-30)/2 = 235


SKYBOX

using CubeTextureLoader, to get z-up orientation:

starting with a nasa star map in hdri (sphere) format where: aries is in the center, the northvstar is on top, and orion is on the left:

upload to:
https://matheowis.github.io/HDRI-to-CubeMap/
and output zip of 6 single, non-rotated files.
the hdri break tool outputs files as follows:

NASA HDRI IMAGE          HDRI     Z-UP   slot rot.
left [orion]          -> nx.png   +y     3    180
bottom (below center) -> ny.png   -z     6    right
sides                 -> nz.png   -x     1    left
right                 -> px.png   -y     4    none
top (above center)    -> py.png   +z     5    right
center                -> pz.png   +x     2    right


extended reference:
the THREE.js CubeTextureLoader slot order is as follows:

slot1 = -x
slot2 = +x
slot3 = +y (above +z)
slot4 = -y (below +z)
slot5 = +z
slot6 = -z


notes on rocket models:

nice model, not centered, cheesy windows:
https://sketchfab.com/3d-models/spacex-starship-a8a0b69f776841a1a465cd9fb3762fd2

nice model, basically centered, wrong roll
https://sketchfab.com/3d-models/starship-mk1-5a708af84ef440c6a91f96c2b8284cc4



ECLIPTIC NOTES

to convert from icrf to ecliptic, use icrfToEci() with:
ra = 270
dec = 66.56071
(but in radians)


ORBIT REFERENCE CONVENTIONS BY POPULARITY
the reference plane used to define the orbit...

1. for all non-sun-orbiters, is the...
  a) equatorial plane of object orbited
  ...
  b) laplace plane
  c) invariable plane
  ...
  d) others

2. for sun orbiters, is the...
  a) ecliptic iau76/80 from icrf J2000
  b) icrf J2000 frame plane
  c) equatorial plane of object orbited (sun)
  ...
  d) invariable plane
  e) la place plane
  f) galactic plane
  ...
  g) any other plane described by ra and dec

real
a 149665014.5
e 0.017118629067
i 0.0004181086
Ω 135.0807
ω 326.728218
M 358.617

simulated, ra 270 deg
2000-01-01T12:00:01.730Z
a 149657995.5553969
e 0.01707254539869325
i 0.0004173390204885836
Ω 224.97454174732968
ω 326.83819734893564
M 358.61347359311605
Ap 151517038.479
Pe 146406952.632
kms 30.292
v51

that's pretty good!  (but why is lan off?)

ra 180 deg:
2000-01-01T12:00:01.160Z
a 149657995.4082693
e 0.017072544425061596
i 32.672160809747325
Ω 222.53659617121215
ω 54.3479117263226
M 358.6134680371585
Ap 151517038.183
Pe 146406952.633
kms 30.292
v52

ra 90 deg
2000-01-01T12:00:00.980Z
a 149657995.36181194
e 0.017072544117620516
i 46.87828501752191
Ω 270.00040449516104
ω 101.8124613187117
M 358.6134662822681
Ap 151517038.090
Pe 146406952.633
kms 30.292
v52

ra 0 deg
2000-01-01T12:00:01.170Z
a 149657995.41085017
e 0.017072544442125397
i 32.67172570453659
Ω 317.46414331681217
ω 149.27694204782932
M 358.61346813668683
Ap 151517038.189
Pe 146406952.633
kms 30.292
v52




other notes:

"space station" commodore 64

https://discourse.threejs.org/t/collision-detection-with-3d-models/16662

https://stackoverflow.com/questions/52271397/centering-and-resizing-gltf-models-automatically-in-three-js

